<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Configuración del libro</title>

<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #f4f4f4;
        margin: 0;
        padding: 20px;
    }

    h2 {
        text-align: center;
        color: #333;
        margin-bottom: 20px;
    }

    form {
        background: #fff;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        max-width: 600px;
        margin: 0 auto;
    }

    label {
        display: block;
        margin-top: 15px;
        font-weight: 600;
        color: #555;
    }

    select, input[type="number"] {
        width: 100%;
        padding: 10px 12px;
        margin-top: 5px;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 14px;
        transition: 0.2s;
    }

    select:focus, input[type="number"]:focus {
        border-color: #007BFF;
        box-shadow: 0 0 5px rgba(0,123,255,0.3);
        outline: none;
    }

    input[type="checkbox"] {
        width: auto;
        margin-right: 8px;
        transform: scale(1.1);
    }

    .hidden {
        display: none;
    }

    .row {
        display: flex;
        gap: 10px;
        margin-top: 5px;
    }

    .row input {
        flex: 1;
    }

    #spineResult {
        font-weight: bold;
        margin-top: 5px;
        color: #007BFF;
    }

    #spineWarning {
        color: #d9534f;
        font-weight: 600;
        margin-top: 5px;
    }
</style>
</head>

<body>

<h2>Configuración del libro</h2>

<form>

    <!-- Tipo de encuadernado -->
    <label for="bindingType">Tipo de encuadernado</label>
    <select id="bindingType">
        <option value="">Seleccione una opción</option>
        <option value="blanda">Tapa blanda</option>
        <option value="dura">Tapa dura</option>
    </select>

    <!-- Papel de cubierta -->
    <label for="paperCover">Papel de cubierta</label>
    <select id="paperCover" disabled>
        <option value="">Seleccione tipo de encuadernado</option>
    </select>

    <div id="bindingOptions" class="hidden">

        <!-- Acabado -->
        <label for="finish">Acabado</label>
        <select id="finish">
            <option value="">Seleccione un acabado</option>
            <option value="pur">PUR</option>
            <option value="cosido_pur">Cosido + PUR</option>
        </select>

        <!-- Papel interior -->
        <label for="paperInterior">Papel interior</label>
        <select id="paperInterior">
            <option value="">Seleccione el papel</option>
            <option value="offset_80">Offset 80 g</option>
            <option value="offset_90">Offset 90 g</option>
            <option value="estucado_115">Estucado mate 115 g</option>
            <option value="estucado_135">Estucado mate 135 g</option>
        </select>

        <!-- Número de páginas -->
        <label for="pages">Número de páginas interiores</label>
        <input type="number" id="pages" min="1" placeholder="Ej. 120">

        <!-- Inserción -->
        <label>
            <input type="checkbox" id="hasInsert">
            Inserción en distinto papel
        </label>

        <div id="insertOptions" class="hidden">

            <label for="paperInsert">Papel de inserción</label>
            <select id="paperInsert">
                <option value="">Seleccione papel de inserción</option>
            </select>

            <label>Rango de páginas de la inserción</label>
            <div class="row">
                <input type="number" id="pageFrom" min="1" placeholder="Desde">
                <input type="number" id="pageTo" min="1" placeholder="Hasta">
            </div>
        </div>
    </div>

    <!-- Ancho de lomo al final -->
    <label>Ancho de lomo estimado</label>
    <div id="spineResult">—</div>
    <div id="spineWarning"></div>

</form>

<script>
    const bindingType   = document.getElementById('bindingType');
    const bindingOptions = document.getElementById('bindingOptions');
    const paperCover    = document.getElementById('paperCover');

    const finish        = document.getElementById('finish');
    const paperInterior = document.getElementById('paperInterior');
    const pagesInput    = document.getElementById('pages');

    const hasInsert     = document.getElementById('hasInsert');
    const insertOptions = document.getElementById('insertOptions');
    const paperInsert   = document.getElementById('paperInsert');

    const spineResult   = document.getElementById('spineResult');
    const spineWarning  = document.getElementById('spineWarning');

    const coverPapersBlanda = [
        { value: 'estucado_250', label: 'Estucado mate 250 g' },
        { value: 'estucado_300', label: 'Estucado mate 300 g' },
        { value: 'cartulina_300', label: 'Cartulina gráfica 300 g' }
    ];

    bindingType.addEventListener('change', () => {
        bindingOptions.classList.toggle('hidden', !bindingType.value);
        updateCoverPaper();
        calculateSpine();
    });

    hasInsert.addEventListener('change', () => {
        insertOptions.classList.toggle('hidden', !hasInsert.checked);
        updateInsertPapers();
    });

    paperInterior.addEventListener('change', updateInsertPapers);
    pagesInput.addEventListener('input', calculateSpine);

    function updateCoverPaper() {
        paperCover.innerHTML = '';
        paperCover.disabled = false;

        if (bindingType.value === 'dura') {
            paperCover.innerHTML = `<option value="estucado_170">Estucado mate 170 g</option>`;
            paperCover.disabled = true;
        } else if (bindingType.value === 'blanda') {
            paperCover.innerHTML = `<option value="">Seleccione papel de cubierta</option>`;
            coverPapersBlanda.forEach(paper => {
                const option = document.createElement('option');
                option.value = paper.value;
                option.textContent = paper.label;
                paperCover.appendChild(option);
            });
        }
    }

    function updateInsertPapers() {
        paperInsert.innerHTML = '<option value="">Seleccione papel de inserción</option>';
        const selectedInterior = paperInterior.value;

        Array.from(paperInterior.options).forEach(option => {
            if (option.value && option.value !== selectedInterior) {
                paperInsert.appendChild(option.cloneNode(true));
            }
        });
    }

    function calculateSpine() {
        const pages = parseInt(pagesInput.value, 10);
        spineResult.textContent = '—';
        spineWarning.textContent = '';

        if (!pages || pages <= 0) return;

        // Cálculo proporcional del lomo
        let spineWidth = (pages / 500) * 60;
        if (spineWidth < 4) spineWidth = 4;
        if (spineWidth > 60) spineWidth = 60;
        spineWidth = parseFloat(spineWidth.toFixed(1));

        spineResult.textContent = `${spineWidth} mm`;

        if (pages < 10) {
            spineWarning.textContent =
                '⚠️ El número de páginas está por debajo de las especificaciones mínimas (4 mm de lomo).';
        } else if (pages > 500) {
            spineWarning.textContent =
                '⚠️ El número de páginas supera las especificaciones máximas (60 mm de lomo).';
        }
    }
</script>

</body>
</html>
